{% extends "myPage.html" %}
{% block main %}
<br>
<h3><b>계약 단계에 필요한 정보를 채워주세요!</b></h3>
<br><br>
<table>
    <tbody>
        <tr>
            <td>계약 번호</td>
            <td>{{k_data[0]}}</td>
        </tr>
        <tr>
            <td>공사명</td>
            <td>{{k_data[1]}}</td>
        </tr>
        <tr>
            <td>업체명</td>                                   
            <td>{{k_data[3]}}</td>
        </tr>
        <tr>
            <td>계약금액(VAT 제외)</td>                                   
            <td>{{k_data[6]}}</td>
        </tr>

    </tbody>
</table>
<style>
    table {
      width: 30%;
      border: 1px solid #444444;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #444444;
      padding: 10px;
    }
</style>
<br>
<!-- 업체 정보 입력 -->
{% if c_data %}
<table>
    <tbody>
        <tr><td>계약일</td><td><p id="d1" class="rowColumn" contenteditable="false" data-default="{{c_data[1]}}">{{c_data[1]}}</p></td></tr>
        <tr><td>공사 시작일</td><td><p id="d2" class="rowColumn" contenteditable="false" data-default="{{c_data[2]}}">{{c_data[2]}}</p></td></tr>
        <tr><td>공사 종료일</td><td><p id="d3" class="rowColumn" contenteditable="false" data-default="{{c_data[3]}}">{{c_data[3]}}</p></td></tr>
        <tr><td>대표자 성명</td><td><p id="d4" class="rowColumn" contenteditable="false" data-default="{{c_data[4]}}">{{c_data[4]}}</p></td></tr>
        <tr><td>사업자등록번호</td><td><p id="d5" class="rowColumn" contenteditable="false" data-default="{{c_data[5]}}">{{c_data[5]}}</p></td></tr>
        <tr><td>법인등록번호</td><td><p id="d6" class="rowColumn" contenteditable="false" data-default="{{c_data[6]}}">{{c_data[6]}}</p></td></tr>
        <tr><td>업체 연락처</td><td><p id="d7" class="rowColumn" contenteditable="false" data-default="{{c_data[7]}}">{{c_data[7]}}</p></td></tr>
        <tr><td>팩스번호</td><td><p id="d8" class="rowColumn" contenteditable="false" data-default="{{c_data[8]}}">{{c_data[8]}}</p></td></tr>
        <tr><td>업체 주소</td><td><p id="d9" class="rowColumn" contenteditable="false" data-default="{{c_data[9]}}">{{c_data[9]}}</p></td></tr>
        <tr><td>은행명</td><td><p id="d10" class="rowColumn" contenteditable="false" data-default="{{c_data[10]}}">{{c_data[10]}}</p></td></tr>
        <tr><td>예금주명</td><td><p id="d11" class="rowColumn" contenteditable="false" data-default="{{c_data[11]}}">{{c_data[11]}}</p></td></tr>
        <tr><td>계좌번호</td><td><p id="d12" class="rowColumn" contenteditable="false" data-default="{{c_data[12]}}">{{c_data[12]}}</p></td></tr>
    </tbody>
</table>
<a href="{{url_for('contractTable')}}"><button type="button" onclick="saveContractInput()">저장하기</button></a>
{% else %}
<form method= "POST" id="contractInput_proc" action="{{url_for('contractInput_proc')}}" class="input-group">
    <input type="text" id="d1" name="d1" class="input-field" placeholder="계약일" required>
    <input type="text" id="d2" name="d2" class="input-field" placeholder="공사 시작일" required>
    <input type="text" id="d3" name="d3" class="input-field" placeholder="공사 종료일" required>
    <input type="text" id="d4" name="d4" class="input-field" placeholder="대표자 성명" required>

    <input type="text" id="d5" name="d5" class="input-field" placeholder="사업자등록번호" required>
    <input type="text" id="d6" name="d6" class="input-field" placeholder="법인등록번호" required>
    <input type="text" id="d7" name="d7" class="input-field" placeholder="업체 연락처" required>
    <input type="text" id="d8" name="d8" class="input-field" placeholder="팩스번호" required>
    <input type="text" id="d9" name="d9" class="input-field" placeholder="계약업체 주소" required>

    <input type="text" id="d10" name="d10" class="input-field" placeholder="은행명" required>
    <input type="text" id="d11" name="d11" class="input-field" placeholder="예금주명" required>
    <input type="text" id="d12" name="d12" class="input-field" placeholder="계좌번호" required>
    <button type="submit" class="submit">저장하기</button>
</form>
{% endif %}
{% endblock %}
{% block js %}
<script type="text/javascript">
    // @breif contenteditable 속성을 가진경우
    contents = document.getElementsByClassName("rowColumn");
    document.addEventListener("DOMContentLoaded", function() {
        // @breif rowColumn 클래스의 갯수 만큼 반복문을 실행한다.
        Array.from(contents).forEach(function(content) {
            // @breif 마우스로 해당영역을 더블클릭 한경우
            content.addEventListener("dblclick", function(event) {
                // @breif 전체 테이블 컬럼( td > p )에서 현재 사용중인 값의 존재여부를 확인한다.
                Array.from(contents).forEach(function(defaultVal) {
                    // @details 빈값( null )이 존재하는지 체크한다.
                    if(
                           defaultVal.textContent == ""
                        || defaultVal.textContent == null
                        || defaultVal.textContent == undefined
                        || (defaultVal.textContent != null
                        && typeof defaultVal.textContent == "object"
                        && !Object.keys(defaultVal.textContent).length == ""))
                    {
                        // @details 내용이 존재하지 않다면 data 태그의 기본값으로 되돌린다.
                        defaultVal.textContent = defaultVal.dataset.default;
                    }
                    // @details 저장하지 않은 내용이라고 판단하여 data 태그의 기본값으로 되돌린다.
                    defaultVal.textContent = defaultVal.dataset.default;
                    // @breif 수정 불가 상태로 되돌린다.
                    defaultVal.contentEditable = false;
                    defaultVal.style.border = "0px";
                });
                if(content.isContentEditable == false) {
                    // @details 편집 가능 상태로 변경
                    content.contentEditable = true;
                    // @details 텍스트 문구 변경
                    // content.textContent = "";
                    // @details CSS 효과 추가
                    content.style.border = "1px solid #FFB6C1";
                    // @details 포커스 지정
                    content.focus();
                }
            });
            // @breif 키보드 입력이 방생한 경우 실행
            content.addEventListener("keypress", function(event) {
                // @breif Enter키 입력시 실행
                if(event.key === "Enter") {
                    // @details 입력된 값이 빈값( null )인지 체크한다.
                    if(
                           content.textContent == ""
                        || content.textContent == null
                        || content.textContent == undefined
                        || (content.textContent != null
                        && typeof content.textContent == "object"
                        && !Object.keys(content.textContent).length == ""))
                    {
                        // @details 내용이 존재하지 않다면 data 태그의 기본값으로 되돌린다.
                        content.textContent = content.dataset.default;
                    } else {
                        // @details 내용의 수정이 완료되었다면 data 태그의 기본값도 바꿔준다.
                        content.dataset.default = content.textContent;
                    }
                    // @breif 수정 불가 상태로 되돌린다.
                    content.contentEditable = false;
                    content.style.border = "0px";
                }
            });
        });
    });
    
function saveContractInput(){
    $.post( "/contractInput_proc", {
    d1: document.getElementById("d1").textContent,
    d2: document.getElementById("d2").textContent,
    d3: document.getElementById("d3").textContent,
    d4: document.getElementById("d4").textContent,
    d5: document.getElementById("d5").textContent,
    d6: document.getElementById("d6").textContent,
    d7: document.getElementById("d7").textContent,
    d8: document.getElementById("d8").textContent,
    d9: document.getElementById("d9").textContent,
    d10: document.getElementById("d10").textContent,
    d11: document.getElementById("d11").textContent,
    d12: document.getElementById("d12").textContent,
    });
} 
/* 저장하기 버튼 */
/* 보낼 수 있는 형식 확인하기. 리턴받는 타입 확인 */
/* document.getElementsByClassName("rowColumn").style.size() */
</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
{% endblock %}